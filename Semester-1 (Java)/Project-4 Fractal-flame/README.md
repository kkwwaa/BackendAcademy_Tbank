## Проект 4: фрактальное пламя

Для дополнительной справки по репозиторию: [HELP.md](./HELP.md)

### Описание

Необходимо реализовать программу, которая позволит генерировать
изображения фрактального пламени на основе идеи Chaos Game.

### Функциональные требования

* Решение должно предоставлять два варианта работы - однопоточный и многопоточный;
* Решение должно реализовывать цветной алгоритм генерации;
* В решении должно быть заложено минимум 4 трансформации из [приложенной статьи](https://flam3.com/flame_draves.pdf);
* В решении должны быть представлены следующие параметры генерации и работы:
  * Размер итогового изображения;
  * Количество итераций;
  * Набор трансформационных функций:
    * Вариант функции;
    * Параметры функции;
  * Путь для сохранения изображения;
  * Количество потоков;
* Решение должно поддерживать несколько вариантов ввода параметров, такие как:
  * Консольный ввод;
  * JSON-файл конфигурации;
  * Параметры по дефолту;
* Решение должно валидировать входные параметры и сообщать в консоль об ошибках;
* Результатом работы решения должно быть изображение в формате PNG, в цветовом диапазоне RGB, 8 бит на канал;

### Нефункциональные требования

* Время выполнения решения в многопоточном режиме должно быть меньше работы в однопоточном;
* Конфигурация решения должна быть простой и интуитивно понятной;
* В случае возникновения ошибки, решение должно вывести корректное описание исключения и где оно возникло;
* Прогресс работы решения должен описываться в логах;
* Логи решения должны содержать прогресс выполнения (например, процент/часть выполненных итераций), сообщения об ошибках и предупреждения. Избегайте избыточного вывода (например, логирование при генерации каждой точки);

### Описание входных и выходных данных

В качестве входных данных ожидается увидеть следующие параметры:
* `-w`/`--width` - int, ширина итогового изображения, по дефолту - `1920`;
* `-h`/`--height` - int, высота итогового изображения, по дефолту - `1080`;
*  `--seed` - long, начальное значение генератора, по дефолту - `5`;
* `-i`/`--iteration-count` - int, количество итераций генерации, по дефолту - `2500`;
* `-o`/`--output-path` - строка, относительный путь до файла, в который нужно записать изображение в формате `PNG`, по дефолту - `result.png`;
* `-t`/`--threads` - int, количество потоков, по дефолту - `1`;
* `-ap`/`--affine-params` - конфигурация аффинных преобразований, строка формата `<a_1>,<b_1>,<c_1>,<d_1>,<e_1>,<f_1>/<a_N>,<b_N>,<c_N>,<d_N>,<e_N>,<f_N>`, где:
* `a` - масштаб/вращение X, double, например - `0.1`;
* `b` - сдвиг-смешивание X от Y, double, например - `0.1`;
* `c` - сдвиг по X, double, например - `0.1`;
* `d` - смешивание Y от X, double, например - `0.1`;
* `e` - масштаб/вращение Y, double, например - `0.1`;
* `f` - сдвиг по Y, double, например - `0.1`;
* `\` - разделитель каждого из элементов массива преобразований;
* `-f`/`--functions` - строка, конфигурация применяемых методов трансформации формата `<функция_N>:<вес_функции>,<функция_N>:<вес_функции>`, например - `swirl:1.0,horseshoe:0.8`, где:
* `<функция_N>` - название функции, например, `swirl`;
* `<вес_функции>` - вес применяемой трансформации/функции, double, например - `1.0`;
* `--config` - строка, относительный путь до файла конфигурации (необязательный);

Пример запуска:

```shell
java -jar $JAR_PATH --seed 32.123531 -i 5000 -f swirl:1.0,horseshoe:0.8 -t 2
```

Так же входные параметры можно представить в виде JSON файла `config.json`:

```json
{
  "size": {
    "width": 1920, 
    "height": 1080
  },
  "iteration_count": 2500,
  "output_path": "result.png",
  "threads": 4,
  "seed": 2.1324512,
  "functions": [
    {
      "name": "swirl",
      "weight": 1.0
    },
    {
      "name": "horseshoe",
      "weight": 0.7
    }
  ],
  "affine_params": [
    {
      "a": 1.0,
      "b": 1.0,
      "c": 1.0,
      "d": 1.0,
      "e": 1.0,
      "f": 1.0
    },
    {
      "a": 0.3,
      "b": 1.0,
      "c": -0.2,
      "d": 0.4,
      "e": 1.0,
      "f": 1.0
    }
  ]
}
```

Пример запуска через CLI с конфигом:

```shell
java -jar $JAR_PATH --config config.json
```

Приоритет параметров следующий:
* Консольный ввод;
* JSON-файл;
* Параметры по дефолту;

### Тестирование

* Предоставьте результаты замеров времени выполнения для 1, 2, 4, 8 потоков при фиксированных параметрах. Сравните с однопоточной версией;
* Для каждой из трансформаций реализуйте тесты, которые проверят корректность изменений;
* Проверьте, что приложение корректно обрабатывает разные варианты конфигурации;

Каждый модуль решения должен быть покрыт юнит-тестами для валидации корректной работы кода. Минимальный уровень покрытия
кода тестами - 80%.

Примеры тестов реализации:
* Unit-тест для каждой из трансформаций, проверяющий корректность вычисления координат и весов;
* Benchmark тест для однопоточной и многопоточной вариаций работы - для сравнения производительности реализации при разных количествах потоков;
* Unit-тест для парсера входных параметров, JSON конфигурации;
* Unit-тест, проверяющий корректность итога работы решения (проверка изображения на соответствие изначальной конфигурации);

### Ограничения и советы

* Убедитесь, что начальная реализация программы работает корректно, прежде чем переходить к многопоточности;
* Используйте профилировщик или отладочные замеры скорости для поиска узких мест;
* Старайтесь разбивать логику на мелкие и независимые вызовы, которые, при необходимости, можно будет переиспользовать. Такой подход облегчит как разработку, так и тестирование;

**Рекомендации к реализации**:

1. Реализуйте логику рендера изображения для однопоточной работы;
2. Добавьте поддержку нескольких трансформаций;
3. Реализуйте поддержку парсинга CLI аргументов и JSON конфигурации;
4. Реализуйте механизм многопоточной обработки;
5. Добавьте тесты для вашего кода;
6. Оптимизируйте логику, проверьте корректность рендера для разных трансформаций;

### Дополнительные материалы

* Описание фрактального пламени:
  * https://en.wikipedia.org/wiki/Fractal_flame
  * https://habr.com/ru/articles/251537
* [Оригинальная статья](https://flam3.com/flame_draves.pdf);
* Что такое Chaos Game:
  * https://en.wikipedia.org/wiki/Chaos_game
  * https://beltoforion.de/en/recreational_mathematics/chaos_game.php
* [Описание СИФ с нуля](https://proproprogs.ru/fractals);
* [Онлайн демо](https://tariqksoliman.github.io/Fractal-Inferno)

### Сроки и процедура сдачи ДЗ

На реализацию проекта отводится весь модуль.

По завершению модуля ассистент имеет полное право выставить 0 баллов за работу, если она не была предоставлена в срок.

Доработка ДЗ по замечаниям возможна до дедлайна. Доработка ДЗ после дедлайна согласуется с ассистентом,
после доработки количество баллов может быть увеличено.
В ответ на задание нужно прислать кликабельную ссылку на репозиторий.

Больше подробностей по сдаче ДЗ можно найти в разделе "Информационный блок".

### Критерии оценки

За задание можно получить 120 баллов, а также бонусные баллы:
1. +10 бонусных баллов, если реализуете 5 и более трансформаций;
2. +10 бонусных баллов, если реализуете поддержку логарифмической гамма-коррекции (описано в [статье](https://flam3.com/flame_draves.pdf)):
* Добавлено поле `gamma_correction` в JSON-конфиг, добавлен параметр `-g`/`--gamma-correction` для CLI:
* Булевое значение, которое включает или выключает гамма-коррекцию;
* В случае включения коррекции, яркость пикселей преобразуется по следующей формуле:
* `color = pow(color, 1.0 / gamma)`, где `gamma` - либо равна `2.2` (значение по умолчанию), либо берется из конфигурации;
* Добавлено поле `gamma` в JSON-конфиг, добавлен параметр `--gamma` для CLI:
* Число с плавающей точкой, определяет значение гаммы для коррекции яркости итогового изображения;
* При наличии параметра в конфигурации, соответствующая логика должна применяться на процесс рендера;
3. +10 бонусных баллов, если вы добавите поддержку симметрии в генерации пламени (описано в [статье](https://flam3.com/flame_draves.pdf)):
* Добавлено поле `symmetry_level` в JSON-конфиг, добавлен параметр `-s`/`--symmetry-level` для CLI:
* Целое число (N >= 1), которое задает количество поворотов вокруг центра;
* Каждая точка дублируется N раз с поворотом на 360/N градусов;
* При наличии параметра в конфигурации, соответствующая логика должна применяться на процесс рендера;
4. +10 бонусных баллов, если вы поделитесь вашим результатом в чате группы и вам поставят лайк;

Дополнительно можно получить личные бонусные баллы на усмотрение ассистента.

Так же можно получить до 18 баллов сверху за проведение кросс-ревью.
Бонус за кросс-ревью начисляется за качественное и своевременное выполнение ревью.

Детали о снятии обычных и начислении бонусных баллов можно найти в разделе "Информационный блок".

### Примеры работ

* [Пример 1](https://www.chaoticafractals.com/art/chaosfissure)
* [Пример 2](https://github.com/alexnardini/FLAM3_for_SideFX_Houdini)

